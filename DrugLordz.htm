<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="js/jquery.colorbox-min.js"></script>
<script>
var score = 0;
var money = 100;
var drugInventory = {
	"marijuana":0,
	"cocaine":0,
	"heroine":0,
	"acid":0,
	"add":function(drugName,amount)
	{
		this[drugName]+=amount
	},
	"remove":function(drugName,amount)
	{
		this[drugName]-=amount
	}
}

var drugs = ["marijuana","cocaine","heroine","acid"];
var prices = {
	"marijuana":20,
	"cocaine":200,
	"heroine":150,
	"acid":50
}
var wholesale_prices = {
	"marijuana":15,
	"cocaine":100,
	"heroine":100,
	"acid":20
}
var drugAmountsFound=[20,50,75,100];
var drugAmountsRequested=[20,20,20,50,50,75,75,100,150,180,200,220,240,260,300,400,500,800,1000]
var spikeMultiplier = {
	"high":1.5,
	"medium": 1.3,
	"low":1.1
}
var events = ["drugs_found","drug_buy","price_spike","cop_bust","drug_buy","drug_buy","wholesale_drug_buy"];

var getRandomEntry = function(arr)
{
	return arr[Math.floor(Math.random() * arr.length)]
}

var eventHandlers = {
	"drugs_found":function(){
		var drugAmountFound = getRandomEntry(drugAmountsFound);
		var drugFound = getRandomEntry(drugs);
		if(confirm("Pick up " + drugAmountFound + " ounces of " + drugFound)){
			drugInventory[drugFound]=parseInt(drugInventory[drugFound])+parseInt(drugAmountFound);
		}
		else
		{
			updateAlerts("decided to leave drugs behind");
		}
		updateEvents("drugs found");
	},
	"drug_buy":function(){
		var drugAmountRequested = getRandomEntry(drugAmountsRequested);
		var drugBought = getRandomEntry(drugs);
		var currentDrugInventory = drugInventory[drugBought];
		if(currentDrugInventory< drugAmountRequested){
			updateAlerts("you don't have enough inventory to support the sale of " + drugAmountRequested + " ounces of " + drugBought);
		}
		else if(confirm("Sell " + drugAmountRequested + " ounces of " + drugBought)){
			drugInventory["remove"](drugBought,parseInt(drugAmountRequested));
			money+=prices[drugBought]*parseInt(drugAmountRequested);
		}
		else
		{
			updateAlerts("decided to leave drugs behind");
		}
		updateEvents("drug buy");
	},
	"price_spike":function(){
		updateEvents("price spike");
	},
	"cop_bust":function(){
		updateEvents("cop bust");
	},
	"wholesale_drug_buy":function(){
		while(true){
			var drug = prompt("Which drug would you like to buy");
			if(drug!=null)
			{
				var quantity = parseInt(prompt("How much would you like to buy"));
				var purchaseAmount = parseInt(quantity) * wholesale_prices[drug];
				
				if(purchaseAmount <= money)
				{
					updateAlerts("you successfully purchased the drugs");
					money -= purchaseAmount;
					drugInventory["add"](drug,parseInt(quantity));
				}
				else
				{
					updateAlerts("You did not have enough money to make this purchase")
				}
				
				if(confirm("Make another purchase"))
				{
					continue;
				}
				else
					break;
			}
			else
				break;
		}	
		updateEvents("cop bust");
	}
}

var inventoryDisplay = function()
{
	var display;
	for(var i=0;i<drugs.length;i++)
	{
		$("#"+drugs[i]).text(drugInventory[drugs[i]]);
	}
	return display;
}


var eventTiming = 5000;

var gameLoop = function()
{
	
		var myEvent = getRandomEntry(events);
		eventHandlers[myEvent]();
		$("#money").text("money: " + money);	
		$("#inventory").text(inventoryDisplay());	
		//setTimeout(eventTiming);

}
var $form;
$(document).ready(function(){
	gameLoop();
})

var currentMenuId;

var toggleMenu = function(id)
{
	
	/*if(currentMenuId!=id)
	{
		$("#"+currentMenuId).toggleClass("showPopUp hidePopUp");
	}
	else
		$("#"+id).toggleClass("showPopUp hidePopUp");	
	*/
	//alert($form);
	$.colorbox({html:$("#"+id).html()});
	currentMenuId=id;
}

var updateEvents = function(message)
{
	previousEvents.push(message);
	$("#events").text(message);
}
var updateAlerts=function(message)
{
	previousEvents.push(message);
	$("#alerts").text(message);
}
var previousEvents=[];

</script>
<style>
	.hidePopUp{
		display:none;
	}
	
	.showPopUp{1
		display:;
	}

</style>
<html>
<body>
<navigation>
	<button onclick="toggleMenu('inventory');">Inventory</button>
</navigation>
<div id="money">
</div><br>
<div id="alerts">
</div>
<div id="events">
</div>
<div id="inventory" class="hidePopUp">
	<table>
		<tr>
			<td>Marijuana</td><td><span id="marijuana"></span></td>
		</tr>
		<tr>
			<td>Cocaine</td><td><span id="cocaine"></span></td>
		</tr>
		<tr>
			<td>Heroine</td><td><span id="heroine"></span></td>
		</tr>
		<tr>
			<td>Acid</td><td><span id="acid"></span></td>
		</tr>

	</table>
</div>
<button onclick="gameLoop()">Next event</button>
</body>
</html>

